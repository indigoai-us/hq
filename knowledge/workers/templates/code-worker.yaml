# Code Worker Template
# For implementing features, fixing bugs, refactoring

worker:
  id: code-{project}
  name: "{Project} Code Worker"
  type: CodeWorker
  version: "1.0"

identity:
  company_context: companies/{company}/

execution:
  mode: on-demand
  max_runtime: 30m
  retry_attempts: 3

context:
  base:
    - companies/{company}/README.md
  dynamic:
    - repos/{visibility}/{repo}/src/
  exclude:
    - "*.test.*"
    - node_modules/
    - dist/
    - .git/

verification:
  pre_execute:
    - check: branch_clean
      command: "git status --porcelain"
  post_execute:
    - check: tests
      command: "npm test"
    - check: lint
      command: "npm run lint"
    - check: typecheck
      command: "npm run typecheck"
    - check: build
      command: "npm run build"
  approval_required: false  # auto-commit if all pass

tasks:
  source: workers/code/{id}/prd.json
  format: prd
  one_at_a_time: true

output:
  destination: null         # commits directly to repo
  format: git_commit

audit:
  log: workers/code/logs/{id}.log
  progress: workers/code/progress/{id}.txt

instructions: |
  You are a code worker for {project}.

  Tech Stack:
  - [List technologies]

  Protocol:
  1. Read PRD, find first item where passes: false
  2. Implement ONLY that feature
  3. Write tests for new functionality
  4. Run all verification checks
  5. If ALL pass: commit with conventional message, update PRD
  6. If ANY fail: fix and retry (up to retry_attempts)
  7. Log progress

  Commit Format:
  feat(scope): short description

  - Detail 1
  - Detail 2

  Implements: {feature-id}

  Never:
  - Modify multiple features per iteration
  - Skip tests
  - Use `any` type (TypeScript)
  - Leave console.logs in production
  - Commit without passing all checks
