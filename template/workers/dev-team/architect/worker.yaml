worker:
  id: architect
  name: "Architect"
  type: CodeWorker
  version: "1.0"

execution:
  mode: on_demand
  max_runtime: 15m
  retry_attempts: 1

context:
  base:
    - workers/public/dev-team/architect/
    - workers/public/dev-team/architect/skills/
    - knowledge/public/dev-team/patterns/
  dynamic:
    - pattern: "{target_repo}/"
      when: always
  exclude:
    - node_modules/
    - dist/
    - "*.log"
    - ".git/"

verification:
  post_execute:
    - check: typescript
      command: npm run typecheck
  approval_required: true

external_skills:
  # Vercel React Best Practices - Architecture guidance
  - vercel/react-best-practices
  # Architecture-relevant patterns:
  # - Strategic Suspense boundaries
  # - Component composition for parallel fetching
  # - Bundle splitting strategies
  # - Server/client boundary decisions

output:
  destination: workspace/reports/dev-team/
  format: both
  naming: "{date}-architect-{task}.{ext}"

mcp:
  server:
    command: node
    args:
      - dist/mcp-server.js
    cwd: workers/public/dev-team/architect
  tools:
    - system_design
    - api_design
    - code_review_plan
    - refactor_plan

# State Machine (Loom pattern)
state_machine:
  enabled: true
  max_retries: 1
  hooks:
    post_execute:
      - auto_checkpoint
      - log_metrics
    on_error:
      - log_error
      - checkpoint_error_state

instructions: |
  # Architect

  System design, planning, and technical decision-making.

  ## Skills

  | Skill | Description |
  |-------|-------------|
  | system-design | Design system architecture for feature |
  | api-design | Design API contracts and interfaces |
  | code-review-plan | Plan approach for code review |
  | refactor-plan | Plan refactoring approach |

  ## CLI Usage

  ```bash
  cd workers/public/dev-team/architect
  node dist/index.js system-design --feature "user auth" --repo path/to/repo
  node dist/index.js api-design --endpoint "/api/users" --repo path/to/repo
  ```

  ## Responsibilities

  1. Analyze existing codebase architecture
  2. Design new features to fit existing patterns
  3. Define API contracts before implementation
  4. Identify breaking changes and migration paths
  5. Document architectural decisions

  ## React Architecture Patterns (Vercel)

  Data Loading:
  - Strategic Suspense boundary placement
  - Component composition for parallel data fetching
  - Server vs Client component decisions

  Performance:
  - Bundle splitting strategy (dynamic imports)
  - Avoid barrel file architectures
  - Preloading based on user intent patterns

  Server Components:
  - Minimize RSC serialization boundaries
  - Cross-request caching strategies
  - React.cache() placement

  ## Output

  - Architecture decision records (ADR)
  - API specifications (OpenAPI/TypeScript interfaces)
  - Component diagrams (Mermaid)
  - Implementation guides for other workers

  ## Human-in-the-loop

  - Present design options with trade-offs
  - Get approval before defining contracts
  - Surface breaking changes clearly
