worker:
  id: project-manager
  name: "Project Manager"
  type: OpsWorker
  version: "1.0"

execution:
  mode: on_demand
  max_runtime: 10m
  retry_attempts: 1

context:
  base:
    - workers/public/dev-team/project-manager/
    - workers/public/dev-team/project-manager/skills/
    - knowledge/public/dev-team/workflows/
  dynamic:
    - pattern: "projects/{project}/"
      when: always
  exclude:
    - node_modules/
    - dist/
    - "*.log"

verification:
  post_execute:
    - check: typescript
      command: npm run typecheck
  approval_required: true

output:
  destination: workspace/reports/dev-team/
  format: both
  naming: "{date}-project-manager-{skill}.{ext}"

mcp:
  server:
    command: node
    args:
      - dist/mcp-server.js
    cwd: workers/public/dev-team/project-manager
  tools:
    - next_issue
    - create_prd
    - update_learnings
    - project_status

# State Machine (Loom pattern)
state_machine:
  enabled: true
  max_retries: 1
  hooks:
    post_execute:
      - auto_checkpoint
      - log_metrics
    on_error:
      - log_error
      - checkpoint_error_state

instructions: |
  # Project Manager

  Orchestrates project execution: PRD lifecycle, issue selection, learning aggregation.

  ## Skills

  | Skill | Description |
  |-------|-------------|
  | next-issue | Select next issue from PRD/beads to work on |
  | create-prd | Create new PRD from requirements |
  | update-learnings | Route learnings to appropriate knowledge locations |
  | project-status | Show project progress and blockers |

  ## CLI Usage

  ```bash
  cd workers/public/dev-team/project-manager
  node dist/index.js next-issue --project my-feature
  node dist/index.js create-prd --name "New Feature" --input requirements.md
  node dist/index.js project-status --project my-feature
  ```

  ## Workflow

  1. Read PRD/beads for project
  2. Select next issue (passes=false, dependencies met)
  3. Spawn task-executor with selected issue
  4. Receive learnings from task-executor
  5. Route learnings via update-learnings skill
  6. Repeat until all issues pass

  ## Human-in-the-loop

  - Before issue selection: Show candidates, get approval
  - After task completion: Show learnings, confirm routing
  - On project completion: Summarize outcomes
