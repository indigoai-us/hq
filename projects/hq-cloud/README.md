# hq-cloud

**Goal:** Run HQ workers from anywhere with real-time monitoring, mobile control, and cloud file sync

**Success:** User can approve a worker's question from phone while away from desk, view worker status, and have files sync to cloud

**Repo:** packages/hq-cloud/ (monorepo)

**Branch:** feature/hq-cloud

## Overview

Cloud infrastructure for running HQ workers remotely with multi-device access, real-time control, and file sync.

### Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                         CLOUD (AWS)                              │
│                                                                  │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐    │
│  │   API        │────▶│  Worker      │────▶│   S3         │    │
│  │   Gateway    │     │  Orchestrator│     │   (HQ Files) │    │
│  │   (WS+REST)  │     │  (ECS/Fargate)│    │              │    │
│  └──────┬───────┘     └──────────────┘     └──────┬───────┘    │
│         │                    │                     │            │
│         │              ┌─────┴─────┐               │            │
│         │              │  Worker   │               │            │
│         │              │  Containers│              │            │
│         │              │  (Claude)  │              │            │
│         │              └───────────┘               │            │
└─────────┼──────────────────────────────────────────┼────────────┘
          │ WebSocket + Push                         │ Sync
┌─────────┴──────────────────────────────────────────┴────────────┐
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐    │
│  │   Mobile     │     │   Desktop    │     │   Web        │    │
│  │   (React     │     │   (HQ + Sync │     │   Dashboard  │    │
│  │    Native)   │     │    Agent)    │     │              │    │
│  └──────────────┘     └──────────────┘     └──────────────┘    │
└──────────────────────────────────────────────────────────────────┘
```

## Quality Gates

- `pnpm typecheck && pnpm lint && pnpm test`

## Sub-Projects

| Phase | Project | Stories | Description |
|-------|---------|---------|-------------|
| 1 | [core-api](sub-projects/core-api/prd.json) | 10 | Central API gateway, WebSocket, auth, worker registry |
| 2 | [worker-runtime](sub-projects/worker-runtime/prd.json) | 10 | Docker containers, ECS Fargate, Claude CLI execution |
| 2 | [file-sync](sub-projects/file-sync/prd.json) | 10 | S3 sync, local daemon, conflict resolution, sharing |
| 3 | [mobile-app](sub-projects/mobile-app/prd.json) | 11 | React Native, Agents list, chat, file browser |

**Total: 41 user stories**

## Dependency Graph

```
Phase 1:  [core-api]
              │
              ├──────────────┐
              ▼              ▼
Phase 2:  [worker-runtime] [file-sync]
              │              │
              └──────┬───────┘
                     ▼
Phase 3:       [mobile-app]
```

## Key Features (from Figma)

- **Agents Screen:** List of running workers with status (4/6), quick Q&A
- **Navigator Screen:** Tree view of HQ filesystem
- **Agent Details:** Full chat conversation with worker

## Non-Goals (for MVP)

- Web dashboard (mobile-first)
- Multi-user governance (single user, multiple devices first)
- Self-hosted option (AWS only for now)
- Worker editing/creation from mobile

## Technical Decisions

- **Containers:** ECS Fargate (serverless, scales to zero)
- **Real-time:** WebSocket + Push Notifications
- **Storage:** S3 with versioning
- **Tech:** Node/TypeScript primary

## E2E Testing (inherited from feature/e2e-cloud-testing)

This branch includes E2E cloud testing infrastructure (knowledge/testing/, .github/workflows/e2e.yml, worker skills, etc.) merged from `feature/e2e-cloud-testing`. This is intentional — we use E2E testing to validate hq-cloud features as they're built.

### Decoupling E2E if needed

The E2E work is **31 pure file additions with zero modifications to existing files**, making removal trivial:

```bash
# List the exact files to remove:
git diff --name-only origin/main...origin/feature/e2e-cloud-testing

# Remove them in one commit:
git diff --name-only origin/main...origin/feature/e2e-cloud-testing | xargs git rm
git commit -m "chore: remove e2e testing infrastructure"
```

Alternatively, rebase `feature/hq-cloud` onto `origin/main` instead of `feature/e2e-cloud-testing` to drop the e2e commits entirely. The `feature/e2e-cloud-testing` branch is preserved independently and has its own PR (#2) to main.

## Open Questions

- [ ] Exact mobile framework: Expo vs bare React Native?
- [ ] Push notification provider: AWS SNS vs Firebase?
- [ ] File sync approach: s3fs mount vs explicit sync?

---

*Generated by /prd on 2026-02-05*
